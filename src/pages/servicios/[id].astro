---
import { getCollection } from "astro:content";

import Layout from "~/layouts/Layout.astro";
import Sub from "~/layouts/sub.astro";

export async function getStaticPaths() {
  const details = await getCollection("details");
  const services = await getCollection("services");

  return details.map((entry) => {
    // Encontrar el servicio correspondiente por ID
    const service = services.find((s) => s.id === entry.id);
    
    return {
      params: { id: entry.id },
      props: { 
        servicio: entry.data,
        serviceType: service?.data.type || null,
      },
    };
  });
}

const { servicio, serviceType } = Astro.props;
---

<Layout>
  <Sub sections={servicio.sections} serviceType={serviceType} />
</Layout>

<style is:global>
  @layer utilities {
    .text-accent {
      color: var(--color-accent);
    }
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: 0.8s ease-out;
    }
    .reveal.active {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .service-hero-subtitle {
    color: var(--color-accent);
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 15px;
  }
</style>

<script>
  const observerOptions = { threshold: 0.2 };
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("active");
      }
    });
  }, observerOptions);
  document.querySelectorAll(".reveal").forEach((el) => observer.observe(el));
</script>
