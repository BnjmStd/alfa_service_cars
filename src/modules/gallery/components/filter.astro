---
import { galleryFilters } from "~/lib/galleryFilters";
---

<nav class="filter-buttons" aria-label="Filtrar galería">
  <span class="filter-indicator" aria-hidden="true"></span>

  {
    galleryFilters.map((filter, i) => (
      <button
        type="button"
        class={`filter-btn ${i === 0 ? "active" : ""}`}
        data-filter={filter.value}
        aria-pressed={i === 0 ? "true" : "false"}
      >
        {filter.label}
      </button>
    ))
  }
</nav>

<script is:inline>
  const container = document.querySelector(".filter-buttons");
  const indicator = container.querySelector(".filter-indicator");
  const buttons = container.querySelectorAll(".filter-btn");

  function isDesktop() {
    return window.matchMedia("(min-width: 768px)").matches;
  }

  document.addEventListener("DOMContentLoaded", () => {
    if (!isDesktop()) return;
    function moveIndicator(target) {
      const containerRect = container.getBoundingClientRect();
      const rect = target.getBoundingClientRect();

      indicator.style.width = `${rect.width}px`;
      indicator.style.transform = `translateX(${rect.left - containerRect.left}px)`;
      indicator.style.opacity = "1";
    }

    // Hover → sigue el mouse
    buttons.forEach((btn) => {
      btn.addEventListener("mouseenter", () => moveIndicator(btn));

      btn.addEventListener("click", () => {
        buttons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        moveIndicator(btn);
      });
    });

    // Al salir, vuelve al activo
    container.addEventListener("mouseleave", () => {
      const active = container.querySelector(".filter-btn.active");
      if (active) moveIndicator(active);
    });

    // Posición inicial
    window.addEventListener("load", () => {
      const active = container.querySelector(".filter-btn.active");
      if (active) moveIndicator(active);
    });
  });
</script>

<style>
  /* MOBILE: ocultar efecto slider */
  @media (max-width: 767px) {
    .filter-indicator {
      display: none;
    }
  }

  .filter-buttons {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-bottom: 60px;
  }

  .filter-btn {
    position: relative;
    z-index: 1;

    background: var(--glass-bg);

    background-color: transparent;

    border: 1px solid var(--glass-border);
    color: var(--color-text-muted);
    padding: 10px 25px;
    border-radius: 999px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn:hover {
    color: white;
    border-color: rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.08);
  }

  .filter-btn.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
    box-shadow: 0 0 15px var(--color-accent-glow);
  }

  /* INDICADOR DESLIZANTE */
  .filter-indicator {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;

    background: var(--color-accent);
    border-radius: 999px;

    box-shadow: 0 0 18px var(--color-accent-glow);

    transition:
      transform 0.45s cubic-bezier(0.22, 1, 0.36, 1),
      width 0.45s cubic-bezier(0.22, 1, 0.36, 1),
      opacity 0.2s ease;

    opacity: 0;
    pointer-events: none;
  }
</style>
