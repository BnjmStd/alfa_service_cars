---
import { galleryFilters } from "~/lib/galleryFilters";
---

<nav class="filter-buttons" aria-label="Filtrar galería">
  {
    galleryFilters.map((filter, i) => (
      <button
        type="button"
        class={`filter-btn ${i === 0 ? "active" : ""}`}
        data-filter={filter.value}
        aria-pressed={i === 0 ? "true" : "false"}
      >
        {filter.label}
      </button>
    ))
  }
</nav>

<script is:inline>
  const container = document.querySelector(".filter-buttons");
  const buttons = container.querySelectorAll(".filter-btn");

  // FUNCIÓN DE FILTRADO
  function filterGallery(category) {
    const items = document.querySelectorAll(".gallery-item-page");
    const emptyState = document.querySelector(".empty-state");
    let visibleCount = 0;

    items.forEach((item) => {
      const itemCategory = item.dataset.category;
      const itemIndex = parseInt(item.dataset.index);

      if (category === "all" || itemCategory === category) {
        // Mostrar solo los primeros 12 items del filtro
        if (visibleCount < 12) {
          item.style.display = "";
          item.style.animation = "fadeInScale 0.4s ease-out forwards";
          visibleCount++;
        } else {
          item.style.display = "none";
        }
      } else {
        // Animación de salida
        item.style.animation = "fadeOutScale 0.3s ease-in forwards";
        setTimeout(() => {
          item.style.display = "none";
        }, 300);
      }
    });

    // Mostrar/ocultar mensaje de empty state
    if (visibleCount === 0) {
      setTimeout(() => {
        emptyState.style.display = "block";
      }, 300);
    } else {
      emptyState.style.display = "none";
    }

    // Disparar evento para que gallery.astro actualice contador
    window.dispatchEvent(
      new CustomEvent("gallery:filter", {
        detail: { filter: category },
      })
    );
  }

  document.addEventListener("DOMContentLoaded", () => {
    // LISTENERS DE FILTRADO
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const filterValue = btn.dataset.filter;

        // Actualizar botones activos
        buttons.forEach((b) => {
          b.classList.remove("active");
          b.setAttribute("aria-pressed", "false");
        });
        btn.classList.add("active");
        btn.setAttribute("aria-pressed", "true");

        // Aplicar filtro
        filterGallery(filterValue);
      });
    });
  });
</script>

<style>
  .filter-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 60px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .filter-btn {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);

    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);

    padding: 10px 20px;
    border-radius: 8px;

    font-size: 0.9rem;
    font-weight: 500;

    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-btn:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    transform: translateY(-1px);
  }

  .filter-btn.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
  }

  /* Mobile */
  @media (max-width: 640px) {
    .filter-buttons {
      max-width: 100%;
      gap: 8px;
    }

    .filter-btn {
      padding: 8px 16px;
      font-size: 0.85rem;
    }
  }
</style>
