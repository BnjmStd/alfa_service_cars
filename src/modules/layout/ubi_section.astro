---
import { getCollection } from "astro:content";

const [currentLocation] = await getCollection("location");

if (!currentLocation) return;

const { map, badge, title, details, cta } = currentLocation.data;
---

<section id="ubicacion" class="location-section">
  <div class="container location-grid">
    <div class="location-info reveal">
      <span class="address-tag scan-observe">{badge}</span>

      <h2 class="location-title">
        {title.text.replace(title.highlight, "")}
        <span class="text-accent">{title.highlight}</span>
      </h2>

      <ul class="location-details">
        {
          details.map((detail) => (
            <li>
              <span class="detail-icon">{detail.icon}</span>
              <div>
                <>
                  <strong>{detail.label}</strong>
                  <br />
                </>
                {detail.content.map((line) => (
                  <>
                    {line}
                    <br />
                  </>
                ))}
              </div>
            </li>
          ))
        }
      </ul>

      <a href={cta.url} target={cta.target} class="btn btn-primary">
        {cta.text}
      </a>
    </div>

    <div class="map-container reveal">
      <iframe
        class="map-iframe"
        src={map.embedUrl}
        loading={map.lazy ? "lazy" : "eager"}
        allowfullscreen={map.allowFullscreen}
      >
      </iframe>

      {map.overlay && <div class="map-overlay" />}
    </div>
  </div>
</section>

<style>
  @layer components {
    .location-section {
      background: var(--color-bg-main);
      padding: 100px 0;
      position: relative;
    }

    .location-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 40px;
      align-items: center;
    }

    @media (min-width: 992px) {
      .location-grid {
        grid-template-columns: 1fr 1.5fr; /* Info a la izquierda, Mapa a la derecha */
      }
    }

    /* Tarjeta de Información */
    .location-info {
      padding-right: 20px;
    }

    .address-tag {
      color: var(--color-accent);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 700;
      font-size: 0.8rem;
      margin-bottom: 15px;
      display: block;
    }

    .location-title {
      font-size: clamp(2.5rem, 4vw, 3.5rem);
      line-height: 1.1;
      margin-bottom: 25px;
      font-weight: 800;
    }

    .location-details {
      list-style: none;
      margin-bottom: 40px;
    }

    .location-details li {
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
      gap: 15px;
      color: var(--color-text-muted);
    }

    .detail-icon {
      color: var(--color-accent);
      font-size: 1.2rem;
      margin-top: 3px;
    }

    /* Contenedor del Mapa Estilo Apple */
    .map-container {
      position: relative;
      border-radius: 32px;
      overflow: hidden;
      border: 1px solid var(--glass-border);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      height: 450px;
      background: var(--color-bg-surface);
    }

    /* Capa de diseño sobre el mapa para que se sienta oscuro */
    .map-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      border-radius: 32px;
      box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* El iframe del mapa */
    .map-iframe {
      width: 100%;
      height: 100%;
      filter: grayscale(1) invert(0.9) contrast(1.2); /* Truco para mapa oscuro */
      opacity: 0.8;
      border: none;
    }
  }
</style>
