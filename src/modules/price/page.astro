---
const { phone = "56912345678" } = Astro.props;
---

<style>
  @layer components {
    .quote-section {
      background: linear-gradient(
        to bottom,
        var(--color-bg-surface),
        var(--color-bg-main)
      );
      padding: 100px 0;
    }

    .quote-container {
      max-width: 800px;
      margin: 0 auto;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--glass-blur));
      border-radius: 32px;
      padding: 50px;
    }

    .status-badge {
      color: var(--color-accent);
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      display: inline-block;
      margin-bottom: 12px;
      padding: 4px 12px;
      border: 1px solid var(--color-accent);
      border-radius: 99px;
    }

    .quote-title {
      font-size: clamp(2rem, 5vw, 2.8rem);
      margin-bottom: 40px;
      font-weight: 800;
      line-height: 1.1;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin-bottom: 35px;
    }

    .option-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
      padding: 25px 15px;
      border-radius: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    /* Animaci√≥n de pulso al seleccionar */
    .option-card.selected {
      border-color: var(--color-accent);
      background: rgba(217, 4, 41, 0.1);
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--color-accent-glow);
    }

    .option-card i {
      font-size: 1.8rem;
      transition: transform 0.3s ease;
    }
    .option-card:hover i {
      transform: translateY(-5px);
    }

    .apple-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--glass-border);
      padding: 18px 25px;
      border-radius: 18px;
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .apple-input:focus {
      outline: none;
      border-color: var(--color-accent);
      background: rgba(255, 255, 255, 0.1);
    }

    .apple-label {
      display: block;
      margin-bottom: 10px;
      font-size: 0.9rem;
      color: var(--color-text-muted);
      font-weight: 500;
    }
  }
</style>

<section id="cotizar" class="quote-section">
  <div class="container">
    <div class="quote-container reveal">
      <span class="status-badge" id="status-text">Configura tu solicitud</span>
      <h2 class="quote-title">
        Lleva tu auto al <span class="text-accent">Siguiente Nivel</span>
      </h2>

      <label class="apple-label">1. Selecciona el tratamiento</label>
      <div class="options-grid" data-group="servicio">
        <div class="option-card" data-value="Cer√°mico">
          <i>üõ°Ô∏è</i>
          <span>Cer√°mico</span>
        </div>
        <div class="option-card" data-value="Polarizado">
          <i>üï∂Ô∏è</i>
          <span>Polarizado</span>
        </div>
        <div class="option-card" data-value="Grabado">
          <i>üî¢</i>
          <span>Grabado</span>
        </div>
        <div class="option-card" data-value="Full Detail">
          <i>‚ú®</i>
          <span>Full Detail</span>
        </div>
      </div>

      <label class="apple-label">2. Tama√±o del veh√≠culo</label>
      <div class="options-grid" data-group="tamano">
        <div class="option-card" data-value="City Car / Sed√°n">
          <i>üöó</i>
          <span>Sed√°n</span>
        </div>
        <div class="option-card" data-value="SUV / Pick-up">
          <i>üöô</i>
          <span>SUV / Pick-up</span>
        </div>
      </div>

      <label class="apple-label">3. Tus datos</label>
      <input
        type="text"
        id="user-name"
        class="apple-input"
        placeholder="Nombre completo"
      />

      <button class="btn btn-primary" id="send-whatsapp">
        Cotizar por WhatsApp
      </button>
    </div>
  </div>
</section>

<script is:inline define:vars={{ phone }}>
  // Variables de estado
  let selectedServicio = "";
  let selectedTamano = "";

  // Seleccion de opciones con delegaci√≥n de eventos
  document.querySelectorAll(".options-grid .option-card").forEach((card) => {
    card.addEventListener("click", () => {
      const parent = card.parentElement;
      const group = parent.dataset.group;

      // Limpiar selecci√≥n del grupo
      parent
        .querySelectorAll(".option-card")
        .forEach((c) => c.classList.remove("selected"));

      // Activar clickeado
      card.classList.add("selected");

      // Guardar valor
      if (group === "servicio") selectedServicio = card.dataset.value;
      if (group === "tamano") selectedTamano = card.dataset.value;

      updateStatus();
    });
  });

  function updateStatus() {
    const statusText = document.getElementById("status-text");
    if (selectedServicio && selectedTamano) {
      statusText.innerText = "¬°Listo para cotizar!";
      statusText.style.borderColor = "white";
      statusText.style.color = "white";
    }
  }

  // L√≥gica de WhatsApp
  document.getElementById("send-whatsapp").addEventListener("click", () => {
    const name = document.getElementById("user-name").value;

    if (!selectedServicio || !selectedTamano || !name) {
      alert(
        "Por favor completa todos los campos para darte un presupuesto exacto."
      );
      return;
    }

    const baseMsg = `Hola Alfa Detailers! üëã\n\nQuiero cotizar un servicio:\n\n‚ú® *Servicio:* ${selectedServicio}\nüöó *Tama√±o:* ${selectedTamano}\nüë§ *Nombre:* ${name}\n\n¬øMe podr√≠an dar m√°s informaci√≥n?`;

    const encodedMsg = encodeURIComponent(baseMsg);
    window.open(`https://wa.me/${phone}?text=${encodedMsg}`, "_blank");
  });
</script>
