---
import type { FaqSection } from "~/layouts/sub.astro";

const section = Astro.props as FaqSection;
const { title, subtitle, faqs } = section;
---

<section
  class="section faq-section"
  style="background: var(--color-bg-surface);"
  id={section.id}
>
  <div class="container">
    <div class="section-header reveal">
      <span class="badge">{subtitle}</span>
      <h2 style="font-size: clamp(2rem, 4vw, 3rem);">
        {title}
      </h2>
    </div>

    <div class="faq-list">
      {
        faqs.map((faq, index) => (
          <div class="faq-item reveal">
            <button 
              class="faq-question"
              aria-expanded="false"
              aria-controls={`faq-answer-${index}`}
              type="button"
            >
              <span class="faq-text">{faq.question}</span>
              <span class="faq-icon">+</span>
            </button>
            <div class="faq-answer" id={`faq-answer-${index}`} role="region">
              <p>{faq.answer}</p>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .faq-section {
    background: var(--color-bg-main);
  }
  .faq-item {
    border-bottom: 1px solid var(--glass-border);
    padding: 30px 0;
  }
  .faq-question {
    width: 100%;
    background: none;
    border: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--color-text-main);
    text-align: left;
    padding: 0;
    transition: color 0.3s ease;
  }
  .faq-question:hover {
    color: var(--color-accent);
  }
  .faq-question.active {
    color: var(--color-accent);
  }

  .faq-icon {
    font-size: 1.8rem;
    margin-left: 20px;
    color: var(--color-text-muted);
    transition: transform 0.3s ease;
    will-change: transform;
  }
  .faq-question.active .faq-icon {
    transform: rotate(45deg);
  }

  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition:
      max-height 0.4s ease-out,
      padding 0.4s ease-out;
    color: var(--color-text-muted);
    padding-top: 0;
    font-size: 1rem;
    will-change: max-height;
  }
  .faq-answer.active {
    max-height: 200px;
    padding-top: 20px;
  }
</style>

<script>
  // --- FAQ ACORDEÓN ---
  function initFAQ() {
    document.querySelectorAll(".faq-question").forEach((question) => {
      question.addEventListener("click", () => {
        const answer = question.nextElementSibling;
        const isExpanded = question.getAttribute("aria-expanded") === "true";
        
        if (answer) {
          question.classList.toggle("active");
          answer.classList.toggle("active");
          question.setAttribute("aria-expanded", (!isExpanded).toString());
        }
      });
    });
  }

  // Ejecutar al cargar la página (incluyendo navegaciones SPA)
  document.addEventListener("astro:page-load", initFAQ);
</script>
